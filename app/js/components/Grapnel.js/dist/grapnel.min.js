/****
 * Grapnel.js
 * https://github.com/EngineeringMode/Grapnel.js
 *
 * @author Greg Sabia Tucker
 * @link http://artificer.io
 * @version 0.4.2
 *
 * Released under MIT License. See LICENSE.txt or http://opensource.org/licenses/MIT
*/

(function(e){function t(){"use strict";var e=this;this.events={};this.params=[];this.state=null;this.version="0.4.2";this.anchor={defaultHash:window.location.hash,get:function(){return window.location.hash?window.location.hash.split("#")[1]:""},set:function(t){window.location.hash=!t?"":t;return e},clear:function(){return this.set(false)},reset:function(){return this.set(this.defaultHash)}};this._forEach=function(e,t){if(typeof Array.prototype.forEach==="function")return Array.prototype.forEach.call(e,t);return function(e,t){for(var n=0,r=this.length;n<r;++n){e.call(t,this[n],n,this)}}.call(e,t)};this.trigger=function(t){var n=Array.prototype.slice.call(arguments,1);if(this.events[t]){this._forEach(this.events[t],function(t){t.apply(e,n)})}return this};this.RouteEvent=function(t,n,r){return{route:n,value:e.anchor.get(),handler:r,params:e.params,regex:t,propagateEvent:true,previousState:e.state,preventDefault:function(){this.propagateEvent=false}}};if(typeof window.onhashchange==="function")this.on("hashchange",window.onhashchange);window.onhashchange=function(){e.trigger("hashchange")};return this.trigger("initialized")}t.regexRoute=function(e,t,n,r){if(e instanceof RegExp)return e;if(e instanceof Array)e="("+e.join("|")+")";e=e.concat(r?"":"/?").replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(e,n,r,i,s,o){t.push({name:i,optional:!!o});n=n||"";return""+(o?"":n)+"(?:"+(o?n:"")+(r||"")+(s||r&&"([^/.]+?)"||"([^/]+?)")+")"+(o||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return new RegExp("^"+e+"$",n?"":"i")};t.prototype.get=t.prototype.add=function(e,n){var r=this,i=[],s=t.regexRoute(e,i);var o=function(){var t=r.anchor.get().match(s);if(t){var o=new r.RouteEvent(t,e,n);r.trigger("match",o);if(!o.propagateEvent)return r;r.state=o;var u={params:{},keys:i,matches:o.regex.slice(1)};r._forEach(u.matches,function(e,t){var n=i[t]&&i[t].name?i[t].name:t;u.params[n]=e?decodeURIComponent(e):undefined});n.call(r,u,o)}return r};return o().on("initialized hashchange",o)};t.prototype.on=t.prototype.bind=function(e,t){var n=this,r=e.split(" ");this._forEach(r,function(e){if(n.events[e]){n.events[e].push(t)}else{n.events[e]=[t]}});return this};t.Router=t.prototype.router=t;t.prototype.context=function(e){var t=this;return function(n,r){var i=e.slice(-1)!=="/"?e+"/":e,s=i+n;return t.get.call(t,s,r)}};t.listen=function(e){return function(){for(var t in e){this.get.call(this,t,e[t])}return this}.call(new t)};if("function"===typeof e.define){e.define(function(e){return t})}else if("object"===typeof exports){exports.Grapnel=t}else{e.Grapnel=t}}).call({},window)
